# Документация функционального блока FB_FrequencyControl

## Обзор

### Назначение

Функциональный блок `FB_FrequencyControl` предназначен для управления частотой выходного сигнала с возможностью плавного изменения (рампы) от текущего значения к заданной уставке. Блок обеспечивает контролируемое изменение частоты с настраиваемым шагом и ограничением максимального значения.

### Область применения

- Управление частотными преобразователями
- Плавный пуск/останов электродвигателей
- Регулирование скорости вращения механизмов
- Системы с требованием плавного изменения частоты


## Интерфейс функционального блока

### Входные параметры (VAR_INPUT)

|Параметр|Тип данных|По умолчанию|Описание|
|---|---|---|---|
|`irMaxFrequency`|`REAL`|100.0|Максимально допустимая частота [Гц]. Ограничивает верхний предел выходной частоты|
|`irStep`|`REAL`|1.0|Шаг изменения частоты по умолчанию [Гц/цикл]. Используется если в методе `Calculate` не задан явный шаг|

### Выходные параметры (VAR_OUTPUT)

|Параметр|Тип данных|Описание|
|---|---|---|
|`qrCurrentFrequency`|`REAL`|Текущее значение выходной частоты [Гц]|
|`qxTargetReached`|`BOOL`|TRUE = целевая частота достигнута, FALSE = идет процесс изменения|

### Внутренние переменные (VAR)

|Переменная|Тип данных|Описание|
|---|---|---|
|`_rSetFrequency`|`REAL`|Целевая частота (уставка) [Гц]|
|`_rCurrentFrequency`|`REAL`|Текущая частота (внутренняя) [Гц]|
|`_xInitialized`|`BOOL`|Флаг инициализации блока|
## Методы

### Calculate

**Описание:** Основной метод обработки, выполняющий плавное изменение частоты к заданной уставке.

**Прототип:**

pascal

```pascal
METHOD Calculate
VAR_INPUT
    rStep : REAL;                // Шаг изменения частоты [Гц/импульс]
    xPulse : BOOL;               // Импульсный сигнал для выполнения шага
    xConditionToProceed : BOOL;  // Разрешение на выполнение
END_VAR
```

**Параметры:**

- `rStep` - величина изменения частоты за один импульс. Если = 0, используется `irStep`
- `xPulse` - фронт 0→1 вызывает один шаг изменения частоты
- `xConditionToProceed` - общее разрешение на работу алгоритма

**Функциональность:**

1. При `xPulse` = TRUE и `xConditionToProceed` = TRUE выполняется один шаг изменения
2. Если текущая частота меньше уставки - увеличение на `rStep`
3. Если текущая частота больше уставки - уменьшение на `rStep`
4. При достижении уставки устанавливается `qxTargetReached` = TRUE

---

### SetFrequencyTarget

**Описание:** Задает целевую частоту для плавного перехода.

**Прототип:**

pascal

```pascal
METHOD SetFrequencyTarget
VAR_INPUT
    rFrequency : REAL;  // Целевая частота [Гц]
END_VAR
```

**Функциональность:**

- Устанавливает новую уставку частоты
- Автоматически ограничивает значение в диапазоне [0...`irMaxFrequency`]
- Сбрасывает флаг `qxTargetReached`

---

### SetFrequencyDirect

**Описание:** Мгновенно устанавливает выходную частоту без плавного перехода.

**Прототип:**

pascal

```pascal
METHOD SetFrequencyDirect
VAR_INPUT
    rFrequency : REAL;  // Частота [Гц]
END_VAR
```

**Функциональность:**

- Немедленно устанавливает выходную частоту
- Синхронизирует уставку с текущим значением
- Устанавливает `qxTargetReached` = TRUE

---

### GetCurrentFrequency

**Описание:** Возвращает текущее значение частоты.

**Прототип:**

pascal

```pascal
METHOD GetCurrentFrequency : REAL
```

**Возвращаемое значение:** Текущая частота [Гц]

---

### GetTargetFrequency

**Описание:** Возвращает значение целевой частоты (уставки).

**Прототип:**

pascal

```pascal
METHOD GetTargetFrequency : REAL
```

**Возвращаемое значение:** Целевая частота [Гц]

---

### Reset

**Описание:** Полный сброс функционального блока в начальное состояние.

**Прототип:**

pascal

```pascal
METHOD Reset
```

**Функциональность:**

- Устанавливает текущую и целевую частоту = 0
- Устанавливает `qxTargetReached` = TRUE
- Сбрасывает все внутренние переменные

---

### Hold

**Описание:** Останавливает изменение частоты на текущем значении.

**Прототип:**

pascal

```pascal
METHOD Hold
```

**Функциональность:**

- Устанавливает уставку равной текущей частоте
- Прекращает процесс рампы
- Устанавливает `qxTargetReached` = TRUE